

```javascript
// ==UserScript==
// @name         Twitter/X Pro å…¨èƒ½æƒ…æŠ¥ç»ˆç«¯ (CTOé¢†å“¥ç‰ˆ V10.5)
// @namespace    http://tampermonkey.net/
// @version      10.5
// @description  1.æ— æ„ŸVIPæ ‡è®° 2.å¤‡æ³¨é˜²ä¸¢ 3.æ¼ç¿»ä¿®å¤ 4.æ™ºèƒ½ç¿»è¯‘ 
// @author       LingGe
// @license      MIT
// @match        https://twitter.com/*
// @match        https://x.com/*
// @match        https://pro.twitter.com/*
// @match        https://pro.x.com/*
// @match        https://tweetdeck.twitter.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=twitter.com
// @grant        GM_xmlhttpRequest
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_registerMenuCommand
// ==/UserScript==

(function() {
    'use strict';

    console.log("ğŸš€ é¢†å“¥æƒ…æŠ¥ç»ˆç«¯ V10.5 (MITå¼€æºç‰ˆ) å·²å¯åŠ¨...");
    const TARGET_LANG = 'zh-CN';
    const GMGN_REF = '1DRFPE0z'; 

    // ================= 0. é»˜è®¤æ•°æ® =================
    const DEFAULT_CONFIG = {
        transColor: '#00E676',
        transFontSize: '14px',
        noteColor: '#1D9BF0',
        noteFontSize: '11px',
        vipBorderColor: '#F3BA2F'
    };

    // å†…ç½®åˆå§‹ VIP åå•
    const INITIAL_VIP_MAP = {
        'vitalikbuterin': ['ğŸ›ï¸ ETHåˆ›å§‹äºº', '#716b94', '#fff'],
        'cz_binance': ['ğŸ”¶ å¸å®‰åˆ›å§‹äºº', '#F0B90B', '#000'],
        'elonmusk': ['ğŸš€ ç‹—ç‹—æ•™çˆ¶', '#000000', '#fff'],
        'brian_armstrong': ['ğŸ›¡ï¸ Coinbase CEO', '#0052FF', '#fff'],
        'aeyakovenko': ['ğŸŸ£ Solanaåˆ›å§‹äºº', '#9945FF', '#fff'],
        'cryptohayes': ['ğŸ“ Arthur Hayes', '#444', '#fff'],
        'zachxbt': ['ğŸš¨ é“¾ä¸Šä¾¦æ¢', '#FF0000', '#fff'],
        'a16z': ['ğŸ’° a16z', '#FF6600', '#fff'],
        'paradigm': ['ğŸ§  Paradigm', '#000', '#fff']
    };

    // ================= 1. å­˜å‚¨ç®¡ç†æ¨¡å— (æœ¬åœ°æ•°æ®åº“) =================
    const Storage = {
        // è¯»å–é…ç½®ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤
        getConfig: () => ({ ...DEFAULT_CONFIG, ...JSON.parse(GM_getValue('ling_config', '{}')) }),
        // ä¿å­˜é…ç½®
        setConfig: (cfg) => GM_setValue('ling_config', JSON.stringify(cfg)),
        
        getNotes: () => JSON.parse(GM_getValue('ling_user_notes', '{}')),
        setNotes: (notes) => GM_setValue('ling_user_notes', JSON.stringify(notes)),
        
        // å®‰å…¨æ·»åŠ å¤‡æ³¨ï¼šé˜²æ­¢è¯¯æ“ä½œ
        addNote: (handle, note) => {
            const notes = Storage.getNotes();
            const h = handle.toLowerCase();
            if (note && note.trim()) {
                notes[h] = note.trim();
            } else {
                // å¦‚æœç”¨æˆ·è¾“å…¥ç©ºç™½ï¼Œä¸”ç¡®è®¤è¦åˆ é™¤ï¼Œåˆ™åˆ é™¤
                delete notes[h];
            }
            Storage.setNotes(notes);
        },
        getNote: (handle) => Storage.getNotes()[handle.toLowerCase()] || null,

        getVips: () => {
            let vips = JSON.parse(GM_getValue('ling_vips', 'null'));
            if (!vips) { vips = INITIAL_VIP_MAP; GM_setValue('ling_vips', JSON.stringify(vips)); }
            return vips;
        },
        setVips: (vips) => GM_setValue('ling_vips', JSON.stringify(vips)),
        
        getVipInfo: (handle) => {
            const vips = Storage.getVips();
            return vips[handle.toLowerCase()] || null;
        },
        
        addVip: (handle, label) => {
            const vips = Storage.getVips();
            vips[handle.toLowerCase()] = [label, '#F3BA2F', '#000'];
            Storage.setVips(vips);
        },
        removeVip: (handle) => {
            const vips = Storage.getVips();
            delete vips[handle.toLowerCase()];
            Storage.setVips(vips);
        },

        // å…¨é‡å¤‡ä»½ï¼šå¤‡æ³¨ + VIP + è®¾ç½®
        export: () => {
            const data = { 
                version: "10.5",
                timestamp: new Date().getTime(),
                notes: Storage.getNotes(), 
                vips: Storage.getVips(), 
                config: Storage.getConfig() 
            };
            const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url;
            a.download = `LingGe_Intel_Backup_${new Date().toISOString().slice(0,10)}.json`; a.click();
        },
        // æ¢å¤å¤‡ä»½
        import: () => {
            const input = document.createElement('input'); input.type = 'file'; input.accept = '.json,.txt';
            input.onchange = (e) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const raw = JSON.parse(event.target.result);
                        // å…¼å®¹æ—§ç‰ˆæ•°æ®ç»“æ„
                        if (raw['$myTwitterNoteItems']) {
                            const notes = Storage.getNotes();
                            for (let k in raw['$myTwitterNoteItems']) { if(raw['$myTwitterNoteItems'][k]?.tag) notes[k.toLowerCase()] = raw['$myTwitterNoteItems'][k].tag; }
                            Storage.setNotes(notes);
                        } else {
                            if(raw.notes) Storage.setNotes({...Storage.getNotes(), ...raw.notes});
                            if(raw.vips) Storage.setVips({...Storage.getVips(), ...raw.vips});
                            if(raw.config) Storage.setConfig({...Storage.getConfig(), ...raw.config});
                        }
                        alert("âœ… æ•°æ®æ¢å¤æˆåŠŸï¼é¡µé¢å°†åˆ·æ–°..."); location.reload();
                    } catch (err) { alert('âŒ å¤‡ä»½æ–‡ä»¶æ ¼å¼é”™è¯¯'); }
                };
                reader.readAsText(e.target.files[0]);
            };
            input.click();
        }
    };

    // ================= 2. åŠ¨æ€æ ·å¼ (æŒä¹…åŒ–åº”ç”¨) =================
    function updateStyles() {
        const cfg = Storage.getConfig();
        const oldStyle = document.getElementById('ling-style'); if (oldStyle) oldStyle.remove();
        const css = `
            .ling-vip-tweet { border: 2px solid ${cfg.vipBorderColor} !important; background: rgba(243, 186, 47, 0.05) !important; border-radius: 8px !important; }
            .ling-identity-badge { font-weight: 900; font-size: 10px; padding: 2px 5px; border-radius: 3px; margin-left: 5px; vertical-align: middle; display: inline-block; box-shadow: 0 1px 2px rgba(0,0,0,0.5); color: #000; background: ${cfg.vipBorderColor}; }
            .ling-trans-box { margin-top: 6px; padding: 8px 10px; background: #000; border: 1px solid ${cfg.transColor}; border-left: 4px solid ${cfg.transColor}; border-radius: 4px; color: ${cfg.transColor} !important; font-size: ${cfg.transFontSize}; line-height: 1.5; font-family: "Consolas", monospace; }
            .ling-ca-link { color: #F3BA2F !important; font-weight: bold; cursor: pointer; background: rgba(243, 186, 47, 0.15); padding: 0 4px; border-radius: 3px; margin-right: 4px; text-decoration: none !important; }
            .ling-ca-link:hover { background: rgba(243, 186, 47, 0.4); }
            .ling-action-btn { cursor: pointer; margin-left: 6px; font-size: 14px; vertical-align: middle; display: inline-block; opacity: 0.4; transition: all 0.2s; filter: grayscale(100%); }
            .ling-action-btn:hover { opacity: 1; filter: grayscale(0%); transform: scale(1.2); }
            .ling-action-btn.active { opacity: 1; filter: grayscale(0%); text-shadow: 0 0 8px gold; }
            .ling-user-note { background-color: ${cfg.noteColor}; color: #fff; font-size: ${cfg.noteFontSize}; padding: 2px 6px; border-radius: 4px; margin-left: 5px; vertical-align: middle; display: inline-block; cursor: pointer; max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: bold; }
            
            #ling-settings-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 99999; display: flex; justify-content: center; align-items: center; }
            #ling-settings-box { background: #16181c; border: 1px solid #333; border-radius: 12px; padding: 20px; width: 300px; color: #fff; }
            .ling-row { margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
            .ling-btn { background: #00E676; color: #000; border: none; padding: 8px; border-radius: 5px; width: 100%; font-weight: bold; cursor: pointer; }
        `;
        const node = document.createElement('style'); node.id = 'ling-style'; node.innerHTML = css; document.head.appendChild(node);
    }

    // ================= 3. æ ¸å¿ƒé€»è¾‘ =================

    // è®¾ç½®èœå•
    function openSettings() {
        if (document.getElementById('ling-settings-overlay')) return;
        const cfg = Storage.getConfig();
        const div = document.createElement('div'); div.id = 'ling-settings-overlay';
        div.innerHTML = `
            <div id="ling-settings-box">
                <h3 style="margin-top:0;color:#F3BA2F">âš™ï¸ ç»ˆç«¯è®¾ç½®</h3>
                <div class="ling-row"><label>ç¿»è¯‘é¢œè‰²</label><input type="color" id="c-tc" value="${cfg.transColor}"></div>
                <div class="ling-row"><label>ç¿»è¯‘å­—å·</label><input type="text" id="c-ts" value="${cfg.transFontSize}" style="width:50px"></div>
                <div class="ling-row"><label>å¤‡æ³¨é¢œè‰²</label><input type="color" id="c-nc" value="${cfg.noteColor}"></div>
                <div class="ling-row"><label>VIPæ¡†è‰²</label><input type="color" id="c-vc" value="${cfg.vipBorderColor}"></div>
                <button class="ling-btn" id="ling-save">ä¿å­˜</button>
                <button class="ling-btn" id="ling-close" style="background:#333;color:#fff;margin-top:10px">å…³é—­</button>
            </div>
        `;
        document.body.appendChild(div);
        document.getElementById('ling-close').onclick = () => div.remove();
        document.getElementById('ling-save').onclick = () => {
            Storage.setConfig({
                transColor: document.getElementById('c-tc').value,
                transFontSize: document.getElementById('c-ts').value,
                noteColor: document.getElementById('c-nc').value,
                noteFontSize: cfg.noteFontSize,
                vipBorderColor: document.getElementById('c-vc').value
            });
            updateStyles(); div.remove();
        };
    }
    GM_registerMenuCommand("âš™ï¸ è®¾ç½®", openSettings);
    GM_registerMenuCommand("ğŸ“¤ å¯¼å‡ºå¤‡ä»½", Storage.export);
    GM_registerMenuCommand("ğŸ“¥ å¯¼å…¥å¤‡ä»½", Storage.import);

    // ç¿»è¯‘ + CAè¯†åˆ« (V10.5 å¼ºç»‘å®šè·¯å¾„ç‰ˆ)
    function translateText(element, text) {
        if (!text || text.trim().length === 0) return;
        
        const cnMatch = text.match(/[\u4e00-\u9fa5]/g);
        if (cnMatch && (cnMatch.length / text.length > 0.4)) return;

        if (element.dataset.lingTranslating) return;
        element.dataset.lingTranslating = "true";

        const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${TARGET_LANG}&dt=t&q=${encodeURIComponent(text)}`;

        GM_xmlhttpRequest({
            method: "GET", url: url,
            onload: (res) => {
                try {
                    const data = JSON.parse(res.responseText);
                    let result = "";
                    if (data && data[0]) data[0].forEach(i => { if(i[0]) result += i[0]; });
                    
                    if (result) {
                        if (element.parentNode.querySelector('.ling-trans-box')) return;
                        const div = document.createElement('div'); div.className = 'ling-trans-box';
                        
                        let processedHtml = result;
                        
                        // 1. Solana (Base58) -> gmgn.ai/sol/token/INVITECODE_ADDRESS
                        processedHtml = processedHtml.replace(/\b([1-9A-HJ-NP-Za-km-z]{32,44})\b/g, (match) => 
                            `<a href="https://gmgn.ai/sol/token/${GMGN_REF}_${match}" target="_blank" class="ling-ca-link" title="å»GMGNäº¤æ˜“">[SOL:âš¡]</a>`
                        );
                        
                        // 2. ETH & BSC (EVM) -> gmgn.ai/chain/token/INVITECODE_ADDRESS
                        processedHtml = processedHtml.replace(/\b(0x[a-fA-F0-9]{40})\b/g, (match) => 
                            `<span style="color:#555;margin:0 2px">|</span>` +
                            `<a href="https://gmgn.ai/eth/token/${GMGN_REF}_${match}" target="_blank" class="ling-ca-link" title="ETHä¸»ç½‘">[ETH]</a>` +
                            `<a href="https://gmgn.ai/bsc/token/${GMGN_REF}_${match}" target="_blank" class="ling-ca-link" title="BSCé“¾">[BSC]</a>`
                        );
                        
                        div.innerHTML = `<span style="opacity:0.7;font-size:10px">[ğŸ¤– é¢†å“¥AIè¯‘]</span><br>${processedHtml}`;
                        element.parentNode.appendChild(div);
                    }
                } catch(e){}
                delete element.dataset.lingTranslating;
            }
        });
    }

    // åŠ¨æ€æ›´æ–°ç•Œé¢
    function refreshUI(handle, container) {
        const note = Storage.getNote(handle);
        let noteSpan = container.querySelector('.ling-user-note');
        
        if (note) {
            if (!noteSpan) {
                noteSpan = document.createElement('span');
                noteSpan.className = 'ling-user-note';
                const toolbar = container.querySelector('.ling-toolbar');
                if (toolbar) container.insertBefore(noteSpan, toolbar);
                else container.appendChild(noteSpan);
            }
            noteSpan.innerText = note;
            noteSpan.onclick = (e) => { e.preventDefault(); e.stopPropagation(); editNote(handle, container); };
        } else if (noteSpan) {
            noteSpan.remove();
        }

        const vipInfo = Storage.getVipInfo(handle);
        let vipBadge = container.querySelector('.ling-identity-badge');
        const article = container.closest('article');
        
        if (vipInfo) {
            if (article) article.classList.add('ling-vip-tweet');
            if (!vipBadge) {
                vipBadge = document.createElement('span');
                vipBadge.className = 'ling-identity-badge';
                container.appendChild(vipBadge);
            }
            vipBadge.innerText = vipInfo[0];
            const starBtn = container.querySelector('.ling-star-btn');
            if (starBtn) starBtn.classList.add('active');
        } else {
            if (article) article.classList.remove('ling-vip-tweet');
            if (vipBadge) vipBadge.remove();
            const starBtn = container.querySelector('.ling-star-btn');
            if (starBtn) starBtn.classList.remove('active');
        }
    }

    function editNote(handle, container) {
        const old = Storage.getNote(handle) || "";
        const val = prompt(`ğŸ“ å¤‡æ³¨ @${handle}:`, old);
        if (val !== null) {
            Storage.addNote(handle, val);
            refreshUI(handle, container);
        }
    }

    function toggleVip(handle, container) {
        const info = Storage.getVipInfo(handle);
        if (info) {
            if (confirm(`âš ï¸ å–æ¶ˆ @${handle} çš„é‡ç‚¹å…³æ³¨ï¼Ÿ`)) {
                Storage.removeVip(handle);
                refreshUI(handle, container);
            }
        } else {
            const label = prompt(`ğŸ”¥ è®¾ä¸ºé‡ç‚¹å…³æ³¨ @${handle}\nè¾“å…¥æ ‡ç­¾ (å¦‚: é¡¶çº§VC):`, "é‡ç‚¹å…³æ³¨");
            if (label) {
                Storage.addVip(handle, label);
                refreshUI(handle, container);
            }
        }
    }

    function processArticle(article) {
        if (article.dataset.lingProcessed) return;
        
        let handle = null, container = null;
        const links = article.querySelectorAll('a[href*="/"]');
        
        for (let link of links) {
            const h = link.getAttribute('href');
            if (h && h.length > 1 && !h.includes('/status/') && !h.includes('/hashtag/')) {
                const cleanHandle = h.replace('/', '').toLowerCase();
                const userNameDiv = article.querySelector('div[data-testid="User-Name"]');
                if (userNameDiv && userNameDiv.contains(link)) {
                    handle = cleanHandle;
                    container = link.querySelector('div[dir="ltr"]') || link.parentNode;
                    break;
                }
            }
        }

        if (handle && container) {
            article.dataset.lingProcessed = "true";
            if (!container.querySelector('.ling-toolbar')) {
                const toolbar = document.createElement('span');
                toolbar.className = 'ling-toolbar';
                toolbar.style.whiteSpace = "nowrap";

                const pen = document.createElement('span');
                pen.className = 'ling-action-btn'; pen.innerHTML = 'âœï¸';
                pen.onclick = (e) => { e.preventDefault(); e.stopPropagation(); editNote(handle, container); };
                
                const star = document.createElement('span');
                star.className = 'ling-action-btn ling-star-btn'; star.innerHTML = 'â­';
                star.onclick = (e) => { e.preventDefault(); e.stopPropagation(); toggleVip(handle, container); };
                
                toolbar.appendChild(pen);
                toolbar.appendChild(star);
                container.appendChild(toolbar);
            }
            refreshUI(handle, container);
        }

        let textDiv = article.querySelector('div[data-testid="tweetText"]');
        if (!textDiv && location.host.includes('tweetdeck')) textDiv = article.querySelector('.tweet-text');
        
        if (textDiv) {
            setTimeout(() => translateText(textDiv, textDiv.innerText), 1000);
        }
    }

    // ================= 4. å¯åŠ¨ =================
    updateStyles();
    const observer = new MutationObserver((ms) => {
        ms.forEach(m => m.addedNodes.forEach(n => {
            if (n.nodeType === 1) {
                if(n.tagName === 'ARTICLE') processArticle(n);
                else n.querySelectorAll('article').forEach(processArticle);
            }
        }));
    });
    
    const start = () => {
        if(document.body) {
            document.querySelectorAll('article').forEach(processArticle);
            observer.observe(document.body, {childList: true, subtree: true});
        } else setTimeout(start, 500);
    };
    start();

})();
```
